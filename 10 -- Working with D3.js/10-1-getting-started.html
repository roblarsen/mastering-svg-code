<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Mastering SVG- D3 Chord Diagram</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
        crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <style type="text/css">
        text {
            font-family: Raleway;
            font-size: .8em;
        }
        text.small-slice {
            opacity:0;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-12" id="target">

            </div>
        </div>
    </div>


    <script src="node_modules/d3/dist/d3.min.js"></script>
    <script src="node_modules/d3-fetch/dist/d3-fetch.min.js"></script>

    <script>

        let width = 1000,
            height = 1000,
            radius = Math.min(width, height) / 2;

        let color = d3.scaleOrdinal()
            .domain(d3.range(9))
            .range([
                "#1fb003",


                "#1CA212",


                "#199522",


                "#178732",

                "#147A41",
                "#126C51",
                "#0F5F61",
                "#0C5170",
                "#0A4480",

                "#073690",

                "#05299F",

                "#021BAF",

                "#000EBF"


            ]);

        let arc = d3.arc()
            .outerRadius(radius - 10)
            .innerRadius(radius - 200);

        let pie = d3.pie()
            .sort(null)
            .value(function (d) { return d.numbers; });

        let svg = d3.select("#target").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

        d3.csv("data.csv").then((data) => {
            let g = svg.selectAll(".arc")
                .data(pie(data))
                .enter().append("g")

            g.append("path")
                .attr("d", arc)
                .style("fill", function (d) { return color(d.data.title); })
                .filter(function (d) {
                    return d.endAngle - d.startAngle < .2;
                })
                .on("mouseover", (e)=>{fade(e,0)})
    .on("mouseout", (e)=>{fade(e,1)});

            svg.selectAll(".arc")
            .data(pie(data)).enter()
                .append("g")
                .attr("class", "text")
                .append("text")
                .attr("transform", function (d) {
                    return "translate(" + arc.centroid(d) + ")";
                })
                .attr("dy", "1em")
                .text(function (d) { return d.data.title; })
                .attr("text-anchor", "middle")
                .style("fill", "#fff")
                .filter(function (d) {
                    return d.endAngle - d.startAngle < .2;
                })
                .attr("class", "small-slice");

        });
        function fade(e,opacity){
            console.log(      svg.selectAll(" text.small-slice")
                .filter((d)=> {
                    return e.index === d.index;
                }))
            svg.selectAll(" text.small-slice")
                .filter((d)=> {
                    return e.index === d.index;
                })
                .transition()
                .style("opacity",opacity)
    };

    </script>

</body>

</html>